<mxfile host="Electron" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/26.2.2 Chrome/134.0.6998.178 Electron/35.1.2 Safari/537.36" version="26.2.2">
  <diagram id="arch" name="Component Architecture">
    <mxGraphModel dx="2139" dy="1863" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="1800" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" value="&lt;b&gt;ha-zoneminder &amp;mdash; Component Architecture&lt;/b&gt;" style="text;html=1;fontSize=22;fontFamily=Helvetica;align=center;verticalAlign=middle;fontColor=#333333;" parent="1" vertex="1">
          <mxGeometry x="250" y="-50" width="600" height="35" as="geometry" />
        </mxCell>
        <mxCell id="subtitle" value="Custom integration for Home Assistant &amp;nbsp;|&amp;nbsp; Library: &lt;b&gt;zm-py 0.5.5.dev13&lt;/b&gt; &amp;nbsp;|&amp;nbsp; Tested: ZoneMinder 1.38.0" style="text;html=1;fontSize=11;fontFamily=Helvetica;align=center;verticalAlign=middle;fontColor=#666666;" parent="1" vertex="1">
          <mxGeometry x="200" y="-18" width="700" height="22" as="geometry" />
        </mxCell>
        <mxCell id="ha" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;container=1;collapsible=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="20" width="1040" height="350" as="geometry" />
        </mxCell>
        <mxCell id="ha_label" value="&lt;b&gt;Home Assistant Core&lt;/b&gt;" style="text;html=1;fontSize=14;fontColor=#333333;align=left;" parent="ha" vertex="1">
          <mxGeometry x="30" y="5" width="200" height="25" as="geometry" />
        </mxCell>
        <mxCell id="haz" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;container=1;collapsible=0;" parent="ha" vertex="1">
          <mxGeometry x="20" y="35" width="1000" height="300" as="geometry" />
        </mxCell>
        <mxCell id="haz_label" value="&lt;b&gt;ha-zoneminder&lt;/b&gt; &amp;nbsp; (custom_components/zoneminder/)" style="text;html=1;fontSize=13;fontColor=#333333;align=left;" parent="haz" vertex="1">
          <mxGeometry x="30" y="5" width="400" height="25" as="geometry" />
        </mxCell>
        <mxCell id="cf" value="&lt;b&gt;config_flow&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;user / import / reconfigure&lt;br&gt;options flow&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#82b366;" parent="haz" vertex="1">
          <mxGeometry x="20" y="40" width="170" height="55" as="geometry" />
        </mxCell>
        <mxCell id="coord" value="&lt;b&gt;coordinator&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;ZmDataUpdateCoordinator&lt;br&gt;30-second refresh interval&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" parent="haz" vertex="1">
          <mxGeometry x="380" y="35" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="svc" value="&lt;b&gt;services&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;zoneminder.set_run_state&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#82b366;" parent="haz" vertex="1">
          <mxGeometry x="830" y="40" width="150" height="55" as="geometry" />
        </mxCell>
        <mxCell id="plat_label" value="Entity Platforms" style="text;html=1;fontSize=10;fontColor=#666666;fontStyle=2;align=left;" parent="haz" vertex="1">
          <mxGeometry x="30" y="135" width="120" height="18" as="geometry" />
        </mxCell>
        <mxCell id="plat_line" value="" style="endArrow=none;html=1;strokeColor=#aaaaaa;strokeWidth=1;dashed=1;" parent="haz" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="110" y="149.71" as="sourcePoint" />
            <mxPoint x="945" y="149.71" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="cam" value="&lt;b&gt;camera&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;MJPEG stream&lt;br&gt;per monitor&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#82b366;" parent="haz" vertex="1">
          <mxGeometry x="90" y="172" width="140" height="55" as="geometry" />
        </mxCell>
        <mxCell id="bs" value="&lt;b&gt;binary_sensor&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;server availability&lt;br&gt;per server&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#82b366;" parent="haz" vertex="1">
          <mxGeometry x="255" y="172" width="140" height="55" as="geometry" />
        </mxCell>
        <mxCell id="sens" value="&lt;b&gt;sensor&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;status, events,&lt;br&gt;run state&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#82b366;" parent="haz" vertex="1">
          <mxGeometry x="420" y="172" width="140" height="55" as="geometry" />
        </mxCell>
        <mxCell id="sel" value="&lt;b&gt;select&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;run state, capturing,&lt;br&gt;analysing, recording&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#82b366;" parent="haz" vertex="1">
          <mxGeometry x="585" y="172" width="160" height="55" as="geometry" />
        </mxCell>
        <mxCell id="sw" value="&lt;b&gt;switch&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;force alarm,&lt;br&gt;function (legacy)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#82b366;" parent="haz" vertex="1">
          <mxGeometry x="770" y="172" width="140" height="55" as="geometry" />
        </mxCell>
        <mxCell id="ec1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;endArrow=classic;endFill=1;strokeColor=#d6b656;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="haz" source="coord" target="cam" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ec2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;endArrow=classic;endFill=1;strokeColor=#d6b656;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="haz" source="coord" target="bs" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ec3" style="rounded=0;endArrow=classic;endFill=1;strokeColor=#d6b656;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.541;entryY=-0.003;entryDx=0;entryDy=0;entryPerimeter=0;" parent="haz" source="coord" target="sens" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ec4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;endArrow=classic;endFill=1;strokeColor=#d6b656;exitX=0.5;exitY=0.967;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitPerimeter=0;" parent="haz" source="coord" target="sel" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ec5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;endArrow=classic;endFill=1;strokeColor=#d6b656;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="haz" source="coord" target="sw" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ver_note" value="&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;select (cap/ana/rec) &amp;rarr; ZM &amp;ge; 1.37 only &amp;nbsp;|&amp;nbsp; switch (function) &amp;rarr; ZM &amp;lt; 1.37 only&lt;/font&gt;" style="text;html=1;align=center;" parent="haz" vertex="1">
          <mxGeometry x="280" y="247" width="420" height="18" as="geometry" />
        </mxCell>
        <mxCell id="zmpy" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;container=1;collapsible=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="425" width="1040" height="220" as="geometry" />
        </mxCell>
        <mxCell id="zmpy_label" value="&lt;b&gt;zm-py 0.5.5.dev13&lt;/b&gt; &amp;nbsp; (PyPI: zm-py &amp;nbsp;|&amp;nbsp; github.com/rohankapoorcom/zm-py)" style="text;html=1;fontSize=13;fontColor=#333333;align=left;" parent="zmpy" vertex="1">
          <mxGeometry x="10" y="5" width="550" height="25" as="geometry" />
        </mxCell>
        <mxCell id="zmc" value="&lt;b&gt;ZoneMinder&lt;/b&gt; (client)&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;login &amp;nbsp;&amp;middot;&amp;nbsp; get_monitors &amp;nbsp;&amp;middot;&amp;nbsp; update_all_monitors&lt;br&gt;get_run_states &amp;nbsp;&amp;middot;&amp;nbsp; get_event_counts &amp;nbsp;&amp;middot;&amp;nbsp; set_active_state&lt;br&gt;is_available &amp;nbsp;&amp;middot;&amp;nbsp; move_monitor&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#d6b656;" parent="zmpy" vertex="1">
          <mxGeometry x="345" y="35" width="350" height="65" as="geometry" />
        </mxCell>
        <mxCell id="mon" value="&lt;b&gt;Monitor&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;function, capturing, analysing,&lt;br&gt;recording, is_recording,&lt;br&gt;is_available, stream URLs,&lt;br&gt;set_force_alarm_state, ptz&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#d6b656;" parent="zmpy" vertex="1">
          <mxGeometry x="30" y="135" width="240" height="75" as="geometry" />
        </mxCell>
        <mxCell id="rs" value="&lt;b&gt;RunState&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;name, active,&lt;br&gt;activate()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#d6b656;" parent="zmpy" vertex="1">
          <mxGeometry x="310" y="135" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="srv" value="&lt;b&gt;Server&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;multi-server&lt;br&gt;URL resolution&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#d6b656;" parent="zmpy" vertex="1">
          <mxGeometry x="510" y="135" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="exc" value="&lt;b&gt;Exceptions&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;CommError &amp;middot; LoginError&lt;br&gt;ControlTypeError &amp;middot; PtzError&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#f8cecc;strokeColor=#b85450;" parent="zmpy" vertex="1">
          <mxGeometry x="720" y="135" width="200" height="65" as="geometry" />
        </mxCell>
        <mxCell id="ez1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;endArrow=classic;endFill=1;strokeColor=#d6b656;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="zmpy" source="zmc" target="mon" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="520" y="115" />
              <mxPoint x="150" y="115" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ez2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;endArrow=classic;endFill=1;strokeColor=#d6b656;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="zmpy" target="rs" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="520" y="105" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="520" y="115" />
              <mxPoint x="390" y="115" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ez3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;endArrow=classic;endFill=1;strokeColor=#d6b656;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="zmpy" source="zmc" target="srv" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="520" y="115" />
              <mxPoint x="590" y="115" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zmsrv" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;container=1;collapsible=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="700" width="1040" height="170" as="geometry" />
        </mxCell>
        <mxCell id="zmsrv_label" value="&lt;b&gt;ZoneMinder Server&lt;/b&gt; &amp;nbsp; (1.36 / 1.37 / 1.38+)" style="text;html=1;fontSize=14;fontColor=#333333;align=left;" parent="zmsrv" vertex="1">
          <mxGeometry x="10" y="5" width="350" height="25" as="geometry" />
        </mxCell>
        <mxCell id="api" value="&lt;b&gt;REST API&lt;/b&gt; (CakePHP 2.x)&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;/api/monitors.json &amp;nbsp;&amp;middot;&amp;nbsp; /api/states.json&lt;br&gt;/api/events/consoleEvents/... &amp;nbsp;&amp;middot;&amp;nbsp; /api/host/login.json&lt;br&gt;/api/monitors/alarm/... &amp;nbsp;&amp;middot;&amp;nbsp; /api/host/daemonCheck.json&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#666666;" parent="zmsrv" vertex="1">
          <mxGeometry x="480" y="40" width="540" height="105" as="geometry" />
        </mxCell>
        <mxCell id="zms" value="&lt;b&gt;ZMS Streaming Daemon&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;color:#666&quot;&gt;nph-zms CGI&lt;br&gt;MJPEG &amp;nbsp;&amp;middot;&amp;nbsp; still frames&lt;br&gt;(stream_scale, stream_maxfps)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#FFFFFF;strokeColor=#666666;" parent="zmsrv" vertex="1">
          <mxGeometry x="70" y="40" width="340" height="105" as="geometry" />
        </mxCell>
        <mxCell id="el1" value="Python API calls" style="rounded=0;endArrow=classic;endFill=1;fontSize=11;fontStyle=2;strokeWidth=2;strokeColor=#82b366;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="haz" target="zmc" edge="1">
          <mxGeometry x="-0.1457" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="el2" value="HTTP (JWT / session cookies)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;endArrow=classic;endFill=1;fontSize=11;fontStyle=2;strokeWidth=2;strokeColor=#d6b656;exitX=0.721;exitY=0.99;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitPerimeter=0;" parent="1" source="zmpy" target="api" edge="1">
          <mxGeometry x="-0.4415" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="el3" value="MJPEG stream (direct)" style="endArrow=classic;endFill=1;rounded=0;fontSize=10;fontStyle=2;strokeColor=#999999;dashed=1;dashPattern=8 4;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;edgeStyle=orthogonalEdgeStyle;" parent="1" source="cam" target="zms" edge="1">
          <mxGeometry x="-0.2709" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-30" y="254" />
              <mxPoint x="-30" y="792" />
            </Array>
            <mxPoint x="-133.4000000000002" y="227.5" as="sourcePoint" />
            <mxPoint x="-170.0000000000001" y="799.5349999999999" as="targetPoint" />
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="auth_note" value="&lt;font style=&quot;font-size:10px;color:#666&quot;&gt;Authentication: JWT (ZM &amp;ge; 1.30) with automatic fallback to legacy session cookies&lt;br&gt;Auto-retry: failed API calls trigger re-auth &amp;amp; retry (up to 2 attempts)&lt;/font&gt;" style="text;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="30" y="880" width="550" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
